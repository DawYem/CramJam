<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CramJam</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .app-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            padding: 15px;
            max-height: 100vh;
            overflow: hidden;
        }

        .main-section {
            display: flex;
            flex-direction: column;
            gap: 15px;
            overflow-y: auto;
            padding-right: 5px;
        }

        .main-section::-webkit-scrollbar {
            width: 5px;
        }

        .main-section::-webkit-scrollbar-thumb {
            background: rgba(147, 112, 219, 0.3);
            border-radius: 5px;
        }

        .player-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: rgba(28, 28, 28, 0.9);
            border-radius: 12px;
            margin-bottom: 10px;
            border: 1px solid rgba(147, 112, 219, 0.3);
        }

        .player-nav {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .nav-link {
            padding: 8px 15px;
            border-radius: 8px;
            background: rgba(147, 112, 219, 0.1);
            color: #fff;
            text-decoration: none;
            transition: all 0.3s ease;
            border: 1px solid rgba(147, 112, 219, 0.2);
            font-size: 0.9rem;
        }

        .nav-link:hover {
            background: rgba(147, 112, 219, 0.2);
            transform: translateY(-2px);
        }

        .section-content {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .timer-section {
            background: rgba(28, 28, 28, 0.9);
            padding: 15px;
            border-radius: 12px;
            border: 1px solid rgba(147, 112, 219, 0.3);
        }

        .timer-display {
            font-size: 2.5rem;
            text-align: center;
            margin: 10px 0;
        }

        .control-group {
            display: flex;
            gap: 10px;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn {
            padding: 8px 15px;
            border-radius: 8px;
            background: rgba(147, 112, 219, 0.1);
            color: #fff;
            border: 1px solid rgba(147, 112, 219, 0.2);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .btn:hover {
            background: rgba(147, 112, 219, 0.2);
            transform: translateY(-2px);
        }

        .input-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .input {
            flex: 1;
            padding: 8px 15px;
            border-radius: 8px;
            background: rgba(28, 28, 28, 0.9);
            border: 1px solid rgba(147, 112, 219, 0.2);
            color: #fff;
            font-size: 0.9rem;
        }

        .player {
            position: relative;
            width: 100%;
            aspect-ratio: 16/9;
            background: rgba(28, 28, 28, 0.9);
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid rgba(147, 112, 219, 0.3);
        }

        .controls {
            position: sticky;
            bottom: 0;
            background: rgba(28, 28, 28, 0.95);
            padding: 12px;
            border-radius: 12px;
            border: 1px solid rgba(147, 112, 219, 0.3);
            z-index: 100;
        }

        #volumeControl {
            width: 120px;
        }

        .section-card {
            background: rgba(28, 28, 28, 0.9);
            padding: 15px;
            border-radius: 12px;
            border: 1px solid rgba(147, 112, 219, 0.3);
        }

        .section-header {
            margin-bottom: 10px;
        }

        .section-title {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title h2, .section-title h3 {
            margin: 0;
            font-size: 1.2rem;
        }

        .section-icon, .timer-icon, .control-icon, .preset-icon {
            font-size: 1.2rem;
        }

        .now-playing {
            background: rgba(28, 28, 28, 0.9);
            padding: 12px;
            border-radius: 12px;
            border: 1px solid rgba(147, 112, 219, 0.3);
        }

        .now-playing p {
            margin: 0;
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.8);
        }

        .groupme-connect {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        #chatMessages {
            max-height: 200px;
            overflow-y: auto;
            padding: 10px;
            background: rgba(28, 28, 28, 0.5);
            border-radius: 8px;
            margin-bottom: 10px;
        }

        #chatMessages::-webkit-scrollbar {
            width: 5px;
        }

        #chatMessages::-webkit-scrollbar-thumb {
            background: rgba(147, 112, 219, 0.3);
            border-radius: 5px;
        }

        .chat-container {
            background: rgba(28, 28, 28, 0.5);
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 10px;
            height: 300px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding-right: 5px;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .chat-messages::-webkit-scrollbar {
            width: 5px;
        }

        .chat-messages::-webkit-scrollbar-thumb {
            background: rgba(147, 112, 219, 0.3);
            border-radius: 5px;
        }

        .chat-message {
            padding: 8px 12px;
            border-radius: 8px;
            max-width: 80%;
            word-wrap: break-word;
        }

        .chat-message.user {
            align-self: flex-end;
            background: rgba(147, 112, 219, 0.2);
            border: 1px solid rgba(147, 112, 219, 0.3);
        }

        .chat-message.other {
            align-self: flex-start;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .chat-message .sender {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.6);
            margin-bottom: 4px;
        }

        .chat-message .content {
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .chat-message .timestamp {
            font-size: 0.7rem;
            color: rgba(255, 255, 255, 0.4);
            text-align: right;
            margin-top: 4px;
        }

        .chat-input-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .chat-input-group .input {
            flex: 1;
        }

        .chat-input-group .btn {
            white-space: nowrap;
        }

        .encouragement-container {
            max-height: 300px;
            overflow-y: auto;
            padding: 10px;
            background: rgba(28, 28, 28, 0.5);
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .encouragement-text {
            color: rgba(255, 255, 255, 0.9);
            font-size: 1rem;
            line-height: 1.5;
            padding: 10px;
        }
    </style>
</head>
<body>
    <div class="background-shapes" id="backgroundShapes"></div>
    <div class="logout-toast" id="logoutToast">Logging out...</div>
    
    <div class="app-container">
        <div class="main-section">
            <div class="player-container">
                <div class="player-header">
                    <div class="section-title">
                        <span class="logo">üéµ</span>
                        <h1>CramJam</h1>
                    </div>
                    <div class="player-nav">
                        <a href="todo-list.html" class="nav-link">üìù Tasks</a>
                        <a href="login.html" class="nav-link">üö™ Logout</a>
                    </div>
                </div>

                <div class="section-content">
                    <div class="timer-section">
                        <div class="section-header">
                            <div class="section-title">
                                <span class="timer-icon">‚è±Ô∏è</span>
                                <h2>Pomodoro Timer</h2>
                            </div>
                        </div>
                        <div class="timer-display" id="timerDisplay">25:00</div>
                        <div class="encouragement-message" id="timerEncouragement">You've got this! Stay focused! üí™</div>
                        <div class="control-group">
                            <button class="btn" id="startTimer">
                                <span class="control-icon">‚ñ∂Ô∏è</span>Start
                            </button>
                            <button class="btn" id="pauseTimer" disabled>
                                <span class="control-icon">‚è∏Ô∏è</span>Pause
                            </button>
                            <button class="btn" id="resetTimer">
                                <span class="control-icon">üîÑ</span>Reset
                            </button>
                        </div>
                        <div class="control-group">
                            <button class="btn preset-btn" data-time="25">
                                <span class="preset-icon">üçÖ</span>Pomodoro
                            </button>
                            <button class="btn preset-btn" data-time="5">
                                <span class="preset-icon">‚òï</span>Short Break
                            </button>
                            <button class="btn preset-btn" data-time="15">
                                <span class="preset-icon">üå¥</span>Long Break
                            </button>
                        </div>
                    </div>

                    <div class="input-group">
                        <input type="text" class="input" id="youtubeUrl" placeholder="üé• Enter YouTube URL">
                        <button class="btn" onclick="addYouTubeTrack()">
                            <span class="section-icon">‚ûï</span>Add YouTube
                        </button>
                    </div>

                    <div class="input-group">
                        <input type="file" id="localFile" accept="audio/*,video/*" style="display: none" multiple>
                        <button class="btn" onclick="document.getElementById('localFile').click()">
                            <span class="section-icon">üìÅ</span>Add Local Files
                        </button>
                    </div>

                    <div class="now-playing">
                        <div class="section-header">
                            <div class="section-title">
                                <span class="section-icon">üéµ</span>
                                <h3>Now Playing</h3>
                            </div>
                        </div>
                        <p id="currentTrack">No track selected</p>
                        <div class="encouragement-message" id="playerEncouragement">Keep going! Every minute counts! ‚≠ê</div>
                    </div>

                    <div class="player">
                        <video id="videoPlayer" controls style="display: none;"></video>
                        <div class="audio-visualizer" style="display: none;">
                            <div class="wave-container" id="waveContainer"></div>
                            <div class="visualizer-overlay">
                                <span class="visualizer-icon">üéµ</span>
                            </div>
                        </div>
                    </div>

                    <div class="controls">
                        <div class="control-group">
                            <button class="btn" onclick="playPrevious()">
                                <span class="control-icon">‚èÆÔ∏è</span>
                            </button>
                            <button class="btn" id="playPauseBtn" onclick="togglePlayPause()">
                                <span class="control-icon">‚ñ∂Ô∏è</span>
                            </button>
                            <button class="btn" onclick="playNext()">
                                <span class="control-icon">‚è≠Ô∏è</span>
                            </button>
                            <input type="range" class="input" id="volumeControl" min="0" max="100" value="100">
                            <span class="control-icon">üîä</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="main-section">
            <div class="section-card">
                <div class="section-header">
                    <div class="section-title">
                        <span class="section-icon">üìã</span>
                        <h3>Playlist DEMO-COMING SOON</h3>
                    </div>
                </div>
                <div class="encouragement-message" id="playlistEncouragement">Your study playlist is ready! Let's make progress! üöÄ</div>
                <div class="section-content" id="playlist">
                    <!-- Playlist items will be added here -->
                </div>
            </div>

            <div class="section-card">
                <div class="section-header">
                    <div class="section-title">
                        <span class="section-icon">üí¨</span>
                        <h3>Encouragement</h3>
                    </div>
                </div>
                <div class="section-content">
                    <div class="encouragement-container">
                        <div id="encouragementMessage" class="encouragement-text">
                            You're capable of more than you know! Keep pushing forward! üí™
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initTimer } from './js/timer.js';
        import { initChat } from './js/chat.js';
        import { 
            addYouTubeTrack, 
            loadYouTubeAPI
        } from './js/youtube.js';
        import { 
            playTrack, 
            togglePlayPause, 
            playNext, 
            playPrevious, 
            removeTrack, 
            loadPlaylist, 
            createWaveBars,
            updateCurrentTrackDisplay,
            savePlaylist,
            initYouTubePlayer
        } from './js/player.js';
        import { 
            initEncouragement,
            updateEncouragementMessages
        } from './js/encouragement.js';

        // Initialize YouTube API and player
        loadYouTubeAPI().then(() => {
            console.log('YouTube API loaded');
            return initYouTubePlayer();
        }).catch(error => {
            console.error('Error loading YouTube API:', error);
        });

        // Initialize components
        document.addEventListener('DOMContentLoaded', () => {
            if (checkLogin()) {
                // Initialize timer independently
                initTimer();
                
                // Initialize other components
                createBackgroundShapes();
                loadPlaylist();
                createWaveBars();
                initChat();
                initEncouragement();
            }
        });

        // Handle local file uploads
        document.getElementById('localFile').addEventListener('change', (event) => {
            const files = event.target.files;
            if (!files || files.length === 0) return;

            if (!window.playlist) {
                window.playlist = [];
            }

            Array.from(files).forEach(file => {
                const url = URL.createObjectURL(file);
                const type = file.type.startsWith('audio/') ? 'audio' : 'video';
                
                const track = {
                    type: type,
                    url: url,
                    title: file.name,
                    file: file
                };

                window.playlist.push(track);
            });

            if (typeof window.updatePlaylistUI === 'function') {
                window.updatePlaylistUI();
            }

            // Play first track if it's the only one
            if (window.playlist.length === files.length && typeof window.playTrack === 'function') {
                window.playTrack(0);
            }

            savePlaylist();
        });

        // Make functions available globally
        window.updateCurrentTrackDisplay = updateCurrentTrackDisplay;
        window.addYouTubeTrack = async function() {
            const urlInput = document.getElementById('youtubeUrl');
            const url = urlInput.value.trim();
            
            if (!url) {
                alert('Please enter a YouTube URL');
                return;
            }

            try {
                // Ensure YouTube API is loaded
                await loadYouTubeAPI();
                // Initialize player if needed
                if (!youtubePlayer) {
                    initializeYouTubePlayer();
                }
                // Add track to playlist
                addYouTubeTrack(url);
                urlInput.value = '';
                savePlaylist();
                // Update playlist encouragement
                updateEncouragementMessages('playlistEncouragement', 'playlist');
            } catch (error) {
                console.error('Error adding YouTube video:', error);
                alert('Error adding YouTube video: ' + error.message);
            }
        };

        window.playTrack = playTrack;
        window.togglePlayPause = togglePlayPause;
        window.playNext = playNext;
        window.playPrevious = playPrevious;
        window.removeTrack = removeTrack;
        window.connectGroupMe = connectGroupMe;
        window.sendMessage = sendMessage;
        window.getNewEncouragement = function() {
            updateEncouragementMessages('encouragementMessage', 'timer');
        };

        // Add logout function
        window.logout = function() {
            localStorage.removeItem('sessionToken');
            window.location.href = 'login.html';
        };

        // Check if user is logged in
        function checkLogin() {
            const sessionToken = localStorage.getItem('sessionToken');
            if (!sessionToken) {
                window.location.href = 'login.html';
                return false;
            }
            return true;
        }

        // Create background shapes
        function createBackgroundShapes() {
            const container = document.getElementById('backgroundShapes');
            const musicIcons = ['üéµ', 'üé∂', 'üéº', 'üéπ', 'üé∏', 'üé∑', 'üé∫', 'üéª', 'ü•Å'];
            
            // Create floating circles
            for (let i = 0; i < 10; i++) {
                const shape = document.createElement('div');
                shape.className = 'shape';
                shape.style.width = `${Math.random() * 200 + 100}px`;
                shape.style.height = shape.style.width;
                shape.style.left = `${Math.random() * 100}%`;
                shape.style.top = `${Math.random() * 100}%`;
                shape.style.animationDelay = `${Math.random() * 15}s`;
                container.appendChild(shape);
            }

            // Create floating music icons
            for (let i = 0; i < 20; i++) {
                const icon = document.createElement('div');
                icon.className = 'music-icon';
                icon.textContent = musicIcons[Math.floor(Math.random() * musicIcons.length)];
                icon.style.left = `${Math.random() * 100}%`;
                icon.style.top = `${Math.random() * 100}%`;
                icon.style.animationDelay = `${Math.random() * 20}s`;
                icon.style.fontSize = `${Math.random() * 20 + 16}px`;
                container.appendChild(icon);
            }
        }

        const encouragementQuotes = [
            "You're capable of more than you know! Keep pushing forward! üí™",
            "Every step you take brings you closer to your goals! üöÄ",
            "Your hard work today will pay off tomorrow! Keep going! ‚≠ê",
            "You're stronger than you think! Don't give up! üåü",
            "Success is built one study session at a time! You've got this! üéØ",
            "The only way to fail is to stop trying! Keep moving forward! üí´",
            "Your dedication is inspiring! Keep up the great work! üåà",
            "Every minute you study is an investment in your future! üìö",
            "You're making progress, even when it doesn't feel like it! üéì",
            "Stay focused, stay determined, and you'll achieve greatness! üèÜ",
            "Your potential is limitless! Keep reaching for the stars! ‚ú®",
            "Remember why you started! Your goals are worth it! üéØ",
            "You're building a brighter future with every study session! üåü",
            "The best way to predict your future is to create it! Keep going! üöÄ",
            "Your persistence is your power! Don't stop now! üí™",
            "Believe in yourself and all that you are! You're amazing! üåü",
            "Small progress is still progress! Keep moving forward! üê¢",
            "Your effort today is your success tomorrow! Keep pushing! üí™",
            "You're not just studying, you're building your future! üèóÔ∏è",
            "Every challenge you face makes you stronger! Keep going! üí™",
            "Your focus and determination will lead to success! üéØ",
            "The more you learn, the more you grow! Keep it up! üå±",
            "You're creating your own success story! Write it well! üìñ",
            "Your dedication to learning is truly inspiring! üåü",
            "Every question you answer brings you closer to mastery! üéì",
            "You're not just studying, you're investing in yourself! üíé",
            "Your commitment to learning is your superpower! ü¶∏",
            "Keep going, you're doing better than you think! üåü",
            "Your study time is your path to success! üõ£Ô∏è",
            "You're building knowledge that will last a lifetime! üè∞",
            "Each study session is a step toward your dreams! üå†",
            "Your brain is like a muscle - the more you use it, the stronger it gets! üí™",
            "The road to success is paved with consistent effort! Keep walking! üõ£Ô∏è",
            "Your future self will thank you for studying today! üôè",
            "Learning is a journey, and you're making great progress! üó∫Ô∏è",
            "Your determination is your greatest asset! Keep it up! üíé",
            "Every concept you master is a victory! Celebrate your progress! üéâ",
            "You're not just memorizing facts, you're expanding your mind! üß†",
            "Your study habits today shape your success tomorrow! üìà",
            "The more you challenge yourself, the more you grow! üå±",
            "Your commitment to learning is your ticket to success! üéüÔ∏è",
            "Every study session is an opportunity to grow! üå±",
            "You're not just studying, you're preparing for greatness! üëë",
            "Your focus today creates your success tomorrow! üéØ",
            "The more you learn, the more doors open for you! üö™",
            "Your dedication to education is your path to freedom! üïäÔ∏è",
            "Every minute of study is a minute closer to your dreams! ‚è≥",
            "You're not just learning, you're transforming your future! ü¶ã",
            "Your study efforts today are your success story tomorrow! üìñ",
            "The more you know, the more you can achieve! üéØ"
        ];

        // Update encouragement message periodically
        setInterval(() => {
            const randomQuote = encouragementQuotes[Math.floor(Math.random() * encouragementQuotes.length)];
            const messageElement = document.getElementById('encouragementMessage');
            if (messageElement) {
                messageElement.textContent = randomQuote;
            }
        }, 30000); // Update every 30 seconds

        // Initialize message on page load
        document.addEventListener('DOMContentLoaded', () => {
            const randomQuote = encouragementQuotes[Math.floor(Math.random() * encouragementQuotes.length)];
            const messageElement = document.getElementById('encouragementMessage');
            if (messageElement) {
                messageElement.textContent = randomQuote;
            }
        });
    </script>
</body>
</html> 